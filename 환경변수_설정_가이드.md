# 🔧 환경 변수 설정 가이드

이 프로젝트는 두 가지 모드로 실행할 수 있습니다:
1. **Webhook 모드** (`main.py`) - 자동 전송만
2. **봇 모드** (`app.py`) - 멘션 기능 포함

각 모드에 따라 필요한 환경 변수가 다릅니다.

---

## 📋 .env 파일 설정 (로컬 개발용)

프로젝트 루트에 `.env` 파일을 만들고 아래 내용을 추가하세요.

### ✅ Webhook 모드만 사용하는 경우 (자동 전송만)

```env
# 필수
SLACK_WEBHOOK_URL=https://hooks.slack.com/services/XXXX/YYYY/ZZZZ
SCHOOL_MENU_WEBSITE_URL=https://mportal2.cau.ac.kr/main.do

# 선택사항
SCHOOL_CODE=
SCHOOL_MENU_API_URL=
SELENIUM_HEADLESS=false  # 로컬 테스트 시 false
```

### ✅ 봇 모드도 사용하는 경우 (멘션 기능 포함)

```env
# Webhook 모드용
SLACK_WEBHOOK_URL=https://hooks.slack.com/services/XXXX/YYYY/ZZZZ

# 봇 모드용 (필수)
SLACK_BOT_TOKEN=xoxb-your-bot-token-here
SLACK_APP_TOKEN=xapp-your-app-token-here

# 학교 메뉴 설정
SCHOOL_MENU_WEBSITE_URL=https://mportal2.cau.ac.kr/main.do
SCHOOL_CODE=
SCHOOL_MENU_API_URL=

# Selenium 설정
SELENIUM_HEADLESS=false  # 로컬 테스트 시 false
```

---

## 🔐 GitHub Actions Secrets 설정

GitHub Actions에서 실행하려면 **Secrets**에 다음 값들을 추가해야 합니다.

### 📍 설정 위치
1. GitHub 리포지토리 → **Settings**
2. 왼쪽 메뉴 → **Secrets and variables** → **Actions**
3. **New repository secret** 클릭

---

### ✅ Webhook 모드용 Secrets (run_bot.yml)

다음 Secrets를 추가하세요:

| Secret 이름 | 설명 | 필수 여부 |
|------------|------|----------|
| `SLACK_WEBHOOK_URL` | Slack Webhook URL | ✅ 필수 |
| `SCHOOL_MENU_WEBSITE_URL` | 학교 홈페이지 URL | ✅ 필수 |
| `SCHOOL_CODE` | 학교 코드 | ⚠️ 선택 |
| `SCHOOL_MENU_API_URL` | 학교 API URL | ⚠️ 선택 |

**참고:** `SELENIUM_HEADLESS`는 워크플로우에서 자동으로 `"true"`로 설정됩니다.

---

### ✅ 봇 모드용 Secrets (run_bot_socket.yml)

다음 Secrets를 추가하세요:

| Secret 이름 | 설명 | 필수 여부 |
|------------|------|----------|
| `SLACK_BOT_TOKEN` | Slack Bot Token | ✅ 필수 |
| `SLACK_APP_TOKEN` | Slack App-Level Token | ✅ 필수 |
| `SCHOOL_MENU_WEBSITE_URL` | 학교 홈페이지 URL | ✅ 필수 |

**참고:** `SELENIUM_HEADLESS`는 워크플로우에서 자동으로 `"true"`로 설정됩니다.

---

## 📝 각 환경 변수 상세 설명

### 1. SLACK_WEBHOOK_URL
- **용도**: Webhook 모드에서 메뉴를 전송할 때 사용
- **형식**: `https://hooks.slack.com/services/XXXX/YYYY/ZZZZ`
- **가져오는 방법**:
  1. Slack API 웹사이트 접속
  2. 앱 선택 → **Incoming Webhooks**
  3. **Webhook URL** 복사

### 2. SLACK_BOT_TOKEN
- **용도**: 봇 모드에서 멘션 기능 사용 시 필요
- **형식**: `xoxb-...` (Bot User OAuth Token)
- **가져오는 방법**:
  1. Slack API 웹사이트 접속
  2. 앱 선택 → **OAuth & Permissions**
  3. **Bot User OAuth Token** 복사

### 3. SLACK_APP_TOKEN
- **용도**: 봇 모드에서 Socket Mode 사용 시 필요
- **형식**: `xapp-...` (App-Level Token)
- **가져오는 방법**:
  1. Slack API 웹사이트 접속
  2. 앱 선택 → **Basic Information**
  3. **App-Level Tokens** 섹션
  4. **Generate Token and Scopes** 클릭
  5. Token Name: `socket-mode`
  6. Scopes: `connections:write` 선택
  7. 생성된 토큰 복사

### 4. SCHOOL_MENU_WEBSITE_URL
- **용도**: 크롤링할 학교 홈페이지 URL
- **형식**: `https://학교도메인.ac.kr/경로`
- **예시**: `https://mportal2.cau.ac.kr/main.do`

### 5. SCHOOL_CODE
- **용도**: 학교 API를 사용하는 경우 (선택사항)
- **형식**: 문자열
- **기본값**: 비워두면 크롤링 모드 사용

### 6. SCHOOL_MENU_API_URL
- **용도**: 학교 API를 사용하는 경우 (선택사항)
- **형식**: `https://api.example.com/menu`
- **기본값**: 비워두면 크롤링 모드 사용

### 7. SELENIUM_HEADLESS
- **용도**: Selenium 브라우저를 헤드리스 모드로 실행할지 여부
- **값**: `"true"` 또는 `"false"`
- **로컬 테스트**: `false` (브라우저 창 표시)
- **서버/GitHub Actions**: `true` (브라우저 창 없이 실행)

---

## 🎯 사용 시나리오별 설정

### 시나리오 1: 로컬에서 테스트만 하기
```env
SLACK_WEBHOOK_URL=https://hooks.slack.com/...
SCHOOL_MENU_WEBSITE_URL=https://mportal2.cau.ac.kr/main.do
SELENIUM_HEADLESS=false
```

### 시나리오 2: GitHub Actions로 자동 전송만 하기
**GitHub Secrets에 추가:**
- `SLACK_WEBHOOK_URL`
- `SCHOOL_MENU_WEBSITE_URL`

### 시나리오 3: 로컬에서 봇 모드 실행 (멘션 기능)
```env
SLACK_BOT_TOKEN=xoxb-...
SLACK_APP_TOKEN=xapp-...
SCHOOL_MENU_WEBSITE_URL=https://mportal2.cau.ac.kr/main.do
SELENIUM_HEADLESS=false
```

### 시나리오 4: GitHub Actions로 봇 모드 실행
**GitHub Secrets에 추가:**
- `SLACK_BOT_TOKEN`
- `SLACK_APP_TOKEN`
- `SCHOOL_MENU_WEBSITE_URL`

---

## ⚠️ 주의사항

1. **`.env` 파일은 절대 Git에 커밋하지 마세요!**
   - `.gitignore`에 포함되어 있어야 합니다.

2. **GitHub Secrets는 암호화되어 저장됩니다.**
   - 코드에 직접 토큰을 적지 마세요.

3. **로컬과 서버 환경 변수는 다를 수 있습니다.**
   - 로컬: `.env` 파일 사용
   - GitHub Actions: Secrets 사용

---

## ✅ 체크리스트

### Webhook 모드 설정 확인
- [ ] `.env`에 `SLACK_WEBHOOK_URL` 설정
- [ ] `.env`에 `SCHOOL_MENU_WEBSITE_URL` 설정
- [ ] GitHub Secrets에 `SLACK_WEBHOOK_URL` 추가
- [ ] GitHub Secrets에 `SCHOOL_MENU_WEBSITE_URL` 추가

### 봇 모드 설정 확인
- [ ] `.env`에 `SLACK_BOT_TOKEN` 설정
- [ ] `.env`에 `SLACK_APP_TOKEN` 설정
- [ ] `.env`에 `SCHOOL_MENU_WEBSITE_URL` 설정
- [ ] GitHub Secrets에 `SLACK_BOT_TOKEN` 추가
- [ ] GitHub Secrets에 `SLACK_APP_TOKEN` 추가
- [ ] GitHub Secrets에 `SCHOOL_MENU_WEBSITE_URL` 추가

